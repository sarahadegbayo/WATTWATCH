<!-- src/views/forgotpassword.ejs -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">
    <div class="text-center mb-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-3">Forgot Password?</h1>
        <p class="text-gray-600">Enter your email address to receive a password reset link.</p>
    </div>
    <svg width="264" height="247" viewBox="0 0 264 247" fill="none" xmlns="http://www.w3.org/2000/svg"
        class="mb-8 max-w-xs">
        <g clip-path="url(#clip0_106_190)">
            <path
                d="M211.008 41.0765C197.451 31.657 166.111 13.4048 165.759 13.2581C165.407 13.1113 165.29 13.0233 161.622 15.5763C159.497 12.5332 156.89 9.85708 153.904 7.6533C152.842 7.01125 151.624 6.67187 150.383 6.67187C149.142 6.67187 147.924 7.01125 146.861 7.6533C144.356 8.94969 142.085 10.6556 140.142 12.7005C136.838 12.491 133.53 13.0224 130.458 14.2558C130.458 14.2558 122.007 -3.55624 108.978 0.639998C95.9491 4.83624 103.813 20.7702 103.813 20.7702C103.46 21.1637 103.127 21.5751 102.816 22.0027C102.173 21.2473 101.455 20.5591 100.673 19.9486C99.1769 19.1856 80.1325 23.9101 70.7423 27.9302C59.4982 32.9016 49.1328 39.6599 40.0481 47.9431C33.4456 55.4846 32.3892 59.6808 34.4433 68.4841C39.6079 90.8739 56.5102 112.149 75.2613 125.706C74.1168 133.629 73.1778 141.552 72.7083 149.533C71.5346 168.666 74.557 177.821 83.9765 185.04C62.4085 250.214 74.9092 422.729 74.9092 422.729C76.5371 424.259 78.5772 425.279 80.778 425.664C80.9247 427.307 81.3649 431.738 81.4236 432.325C78.7532 434.342 75.9162 436.129 72.9431 437.665C71.9162 438.007 71.0311 438.678 70.426 439.575C69.8208 440.472 69.5297 441.545 69.5978 442.625C69.187 445.207 80.5139 445.09 83.6831 444.796C86.8523 444.503 86.9697 442.419 87.6153 442.155C88.2608 441.891 88.1434 443.417 88.0554 444.209C87.9674 445.002 90.9899 445.09 92.8386 445.119C94.6872 445.148 94.4525 427.219 94.5699 426.074C96.5808 425.79 98.5509 425.268 100.439 424.519C121.42 368.178 123.093 332.525 123.093 332.525C115.551 272.897 116.93 232.343 119.16 232.754C121.391 233.165 117.752 248.394 122.095 303.885C126.438 359.375 144.631 429.332 144.631 429.332C147.009 429.76 149.41 430.054 151.821 430.212C151.997 431.973 152.525 436.521 152.584 437.079C149.978 439.01 147.22 440.727 144.338 442.214C143.311 442.552 142.426 443.223 141.825 444.122C141.224 445.021 140.942 446.095 141.022 447.173C140.582 449.755 151.909 449.638 155.107 449.344C158.306 449.051 158.364 446.968 159.01 446.703C159.656 446.439 159.538 447.965 159.45 448.758C159.362 449.55 162.385 449.638 164.233 449.667C166.082 449.697 164.468 439.661 166.287 430.329C168.05 430.241 169.79 429.895 171.452 429.302C171.452 429.302 179.815 408.761 184.774 319.378C189.352 237.214 181.136 195.839 179.786 189.676C181.512 188.708 182.959 187.311 183.987 185.619C185.015 183.928 185.59 182 185.655 180.022C185.655 178.848 184.452 132.015 184.187 128.347C197.362 118.622 209.314 107.34 219.782 94.7473C225.128 88.7319 228.846 81.4484 230.581 73.5901C233.251 58.1256 223.773 49.9092 211.008 41.0765ZM146.891 8.21084C148.136 7.5479 149.573 7.33477 150.957 7.60739C152.342 7.88001 153.59 8.6217 154.491 9.7074C156.583 11.9125 158.786 14.0085 161.093 15.9871C158.093 18.3288 156.015 21.654 155.225 25.3773C155.224 22.5254 154.108 19.787 152.114 17.7478C148.956 14.8791 144.948 13.1175 140.699 12.7299C142.587 10.9958 144.664 9.47988 146.891 8.21084ZM147.331 69.834C147.296 69.7855 147.249 69.746 147.196 69.7188C147.142 69.6916 147.083 69.6774 147.023 69.6774C146.963 69.6774 146.904 69.6916 146.850 69.7188C146.797 69.746 146.750 69.7855 146.715 69.834L144.573 72.0348C144.074 69.1004 143.369 62.9967 143.428 62.9674C144.895 62.0871 153.904 43.5708 155.166 30.043C161.915 41.364 170.368 51.5782 180.226 60.3264C181.635 61.5882 188.178 66.8409 188.325 66.9289C187.768 67.1343 153.699 77.0233 152.378 77.7276C150.706 74.9399 148.945 72.4456 147.331 69.7753V69.834ZM152.231 79.3122C150.295 82.0412 142.313 91.8129 140.67 94.2778C138.093 90.6494 135.741 86.8667 133.627 82.9509C138.26 79.0867 142.697 74.9929 146.92 70.685C148.681 73.502 150.324 76.4658 152.231 79.2535V79.3122ZM108.479 26.9619C111.091 26.4337 111.414 33.6524 122.828 35.3544C122.352 35.3744 121.886 35.5007 121.464 35.7241C121.043 35.9475 120.677 36.2623 120.393 36.6455C120.393 36.6455 124.266 35.0316 125.205 37.966C125.205 38.1421 125.675 37.966 125.704 37.8193C125.745 37.2946 125.604 36.7717 125.305 36.3387C125.006 35.9058 124.566 35.5892 124.061 35.4424C125.767 35.6105 127.482 35.6693 129.196 35.6185C136.18 35.4717 133.04 43.8055 135.241 44.2164C136.298 44.4218 136.444 43.3654 137.501 42.2209C138.557 41.0765 140.67 39.6973 142.372 41.0178C146.861 44.5685 140.905 50.9656 140.905 50.9656C141.175 58.2257 142.267 65.4318 144.162 72.4456C138.557 77.9917 132.718 82.7455 132.718 83.0096C131.778 83.0096 127.582 83.8312 126.056 84.154C124.387 80.7544 122.927 77.2559 121.684 73.6781C121.904 72.0839 121.992 70.4743 121.948 68.8656C121.948 64.552 118.251 66.1659 115.845 65.491C114.362 65.0417 113.011 64.2356 111.912 63.1435C109.623 60.7053 108.111 57.6407 107.569 54.3402C106.808 50.5397 106.366 46.6821 106.249 42.8078C106.073 38.1714 105.251 27.6075 108.479 26.9619ZM112.91 81.2489C110.445 80.2512 78.988 61.9697 76.6992 59.9449C78.812 58.2723 99.353 44.9206 105.398 41.8688C105.398 51.4644 106.542 64.7868 115.991 66.7822C118.427 67.281 120.158 66.43 120.51 67.8679C120.657 68.4841 120.716 70.4796 120.804 72.0935C120.727 72.0524 120.641 72.0309 120.554 72.0309C120.467 72.0309 120.382 72.0524 120.305 72.0935C119.102 73.4727 111.883 79.4589 112.088 79.723C112.39 80.216 112.665 80.7254 112.91 81.2489ZM120.452 74.0302C120.95 75.5855 124.618 81.8945 125.528 83.7432C125.528 83.7432 119.982 90.9326 119.102 92.5465C118.28 90.4631 113.644 80.5447 113.233 79.8697C115.903 78.3145 117.341 76.0256 120.452 74.1476V74.0302ZM93.1907 432.765C89.3466 436.374 83.2429 433.616 82.2746 432.765C82.2746 431.973 81.6583 427.248 81.4529 425.693C85.565 426.133 89.7033 426.28 93.8363 426.133C93.6602 427.101 93.1907 431.532 93.1907 432.765ZM164.556 437.167C162.937 438.341 160.981 438.959 158.981 438.928C156.981 438.896 155.045 438.216 153.464 436.991C153.464 436.286 152.76 431.65 152.554 430.036C154.462 430.036 163.999 430.3 165.701 430.036C165.495 431.65 164.703 436.316 164.527 437.167H164.556ZM229.114 75.7029C226.932 82.5308 223.332 88.8207 218.55 94.1604C208.188 106.52 196.364 117.576 183.337 127.085C182.779 127.496 185.009 180.521 184.217 182.634C183.12 185.188 181.226 187.319 178.817 188.708C170.513 194.019 123.063 197.511 95.9784 189.764C91.3065 188.552 87.0168 186.178 83.5077 182.864C79.9986 179.55 77.3841 175.403 75.9069 170.808C74.0381 164.332 73.3718 157.569 73.9408 150.854C74.557 136.182 76.8752 119.983 78.7826 105.781C78.7826 105.781 78.5478 105.575 78.5185 105.781C77.3741 112.295 76.3176 118.458 75.3786 125.031C71.3878 121.685 67.3383 118.722 63.6409 115.083C51.3378 103.54 42.1694 89.0606 36.9963 73.0032C33.4162 60.5025 34.7661 57.5974 39.5492 51.0536C40.7452 49.345 42.1335 47.7795 43.6868 46.3878C51.2247 39.9351 59.5697 34.4901 68.5121 30.1898C78.7906 25.9498 89.4799 22.7834 100.409 20.7409C101.07 21.4049 101.688 22.1106 102.258 22.8537C100.556 25.3186 98.326 29.5735 100.087 33.0949C101.152 35.8082 103.066 38.1039 105.545 39.6386V41.0765C100.028 43.8642 77.6382 57.8028 75.3493 59.5928C75.2854 59.6531 75.2344 59.7259 75.1996 59.8067C75.1648 59.8874 75.1468 59.9744 75.1468 60.0623C75.1468 60.1502 75.1648 60.2372 75.1996 60.318C75.2344 60.3987 75.2854 60.4715 75.3493 60.5318C84.1526 68.1613 110.739 81.4543 113.761 82.3053C114.524 83.6845 117.928 91.1086 118.896 93.4562C118.896 93.6909 119.366 93.8377 119.513 93.4562C120.338 91.6894 121.351 90.0168 122.535 88.4676C122.682 89.9055 123.533 94.718 127.083 95.7157C130.634 96.7134 135.447 91.4608 135.887 88.673C135.887 88.9078 139.027 93.4562 140.288 95.5396C140.334 95.6227 140.398 95.6941 140.476 95.7484C140.553 95.8026 140.643 95.8382 140.736 95.8524C140.83 95.8666 140.926 95.859 141.016 95.8302C141.106 95.8014 141.189 95.7522 141.257 95.6863C143.252 93.1334 150.823 82.0706 153.141 79.547C153.435 79.2535 153.141 79.0481 152.672 78.1091C153.875 78.1091 192.492 66.6648 195.426 65.0508C195.749 64.8748 195.426 64.3759 195.162 64.464C193.313 64.9531 191.491 65.5408 189.704 66.2246C178.906 57.1866 171.335 52.4034 161.152 38.1421C157.425 32.9188 156.809 31.3048 155.283 28.928C155.645 25.8485 156.778 22.9104 158.579 20.3863C160.38 17.8623 162.789 15.8342 165.583 14.4905C167.725 15.7523 184.921 25.0545 202.586 36.4108C210.392 41.4286 221.161 48.5593 226.062 55.4552C228.063 58.3821 229.381 61.7209 229.92 65.2253C230.458 68.7297 230.203 72.3103 229.172 75.7029H229.114Z"
                fill="#0A2F25" />
        </g>
        <defs>
            <clipPath id="clip0_106_190">
                <rect width="263" height="247" fill="white" transform="translate(0.5)" />
            </clipPath>
        </defs>
    </svg>
    <form id="resetForm" class="w-full max-w-xs space-y-4">
        <input type="hidden" name="_csrf" id="csrfToken" value="<%= csrfToken %>">
        <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
            <input type="email" id="email"
                class="w-full px-4 py-3 rounded-2xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition duration-200"
                placeholder="yourname@example.com" required />
        </div>
        <div id="formMessage" class="text-sm font-medium text-center mb-4"></div>
        <button id="submitBtn" type="submit"
            class="w-full bg-black hover:bg-gray-800 text-white font-semibold py-3 px-4 rounded-2xl transition duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 flex items-center justify-center">
            <span id="submitText">Request Reset Link</span>
            <span id="spinner" class="hidden ml-2">⏳</span>
        </button>
        <div class="text-center text-sm text-gray-600">
            Remember your password?
            <a href="/api/v1/auth/signin" class="text-blue-600 hover:text-blue-800 font-medium">Log In</a>
        </div>
    </form>
    <script>
        document.getElementById('resetForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const email = document.getElementById('email').value.trim();
            const csrfToken = document.getElementById('csrfToken').value;
            const message = document.getElementById('formMessage');
            const submitBtn = document.getElementById('submitBtn');
            // Reset message
            message.textContent = '';
            message.className = 'text-sm font-medium text-center';
            // Basic email validation
            const emailRegex = /\S+@\S+\.\S+/;
            if (!emailRegex.test(email)) {
                message.textContent = 'Please enter a valid email address.';
                message.classList.add('text-red-600');
                return;
            }
            // Simulate loading state
            document.getElementById('submitText').textContent = 'Sending...';
            document.getElementById('spinner').classList.remove('hidden');
            submitBtn.disabled = true;
            try {
                const response = await fetch('/api/v1/auth/reset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRF-Token': csrfToken
                    },
                    body: new URLSearchParams({ email, _csrf: csrfToken }).toString(),
                });
                const data = await response.json();
                if (!response.ok || !data || !data.message) {
                    throw new Error(data?.message || 'Something went wrong.');
                }
                message.textContent = data.message;
                message.classList.add('text-green-600');
                setTimeout(() => {
                    window.location.href = "/api/v1/auth/signin";
                }, 3000);
            } catch (error) {
                message.textContent = error.message;
                message.classList.add('text-red-600');
            } finally {
                document.getElementById('submitText').textContent = 'Request Reset Link';
                document.getElementById('spinner').classList.add('hidden');
                submitBtn.disabled = false;
            }
        });
    </script>
</body>

</html>